#################################################################
# SHADER_GRAYSCALE                                              #
# Aplica grayscale ao frame buffer.                             #
# 							        #
# ARGUMENTOS:						        #
#	(nenhum)                                                #
#							        #
# RETORNOS:                                                     #
#       (nenhum)                                                #
#################################################################

.data

GRAYSCALE_TABLE:
# gerado com L = (R+ G)/2, e depois R = L, G = L, B = L/2.
.byte 0x00, 0x00, 0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0x00, 0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4
0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD
0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6
0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6, 0xF6, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6, 0xF6, 0xFF
0x00, 0x00, 0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0x00, 0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4
0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD
0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6
0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6, 0xF6, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6, 0xF6, 0xFF
0x00, 0x00, 0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0x00, 0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4
0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD
0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6
0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6, 0xF6, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6, 0xF6, 0xFF
0x00, 0x00, 0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0x00, 0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4
0x09, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0x09, 0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD
0x52, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0x52, 0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6
0x5B, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6, 0xF6, 0x5B, 0xA4, 0xA4, 0xAD, 0xAD, 0xF6, 0xF6, 0xFF

.text

SHADER_GRAYSCALE:
        lw t1, FRAME_BUFFER_PTR
        lw t2, FRAME_BUFFER_FIM_PTR
        la t3, GRAYSCALE_TABLE

# t1 = endereco inicial
# t2 = Pm = endereco limite
# t3 = Lookup table
        
S_GS1_LOOP:
        # agora devemos pegar o que estah em t1 e colocar em FRAME_BUFFER
        beq t1,t2,S_GS1_FIM		# se for o ultimo endereco ent sai do loop
        lbu t0,0(t1)                    # pega um byte da tela

        add t6, t3, t0                  # pega o endereco dele na table

        lbu t0, (t6)                     # carrega o byte da table

        sb t0,0(t1)			# salva o byte no buffer
        addi t1,t1,1                    # pula um byte
        j S_GS1_LOOP			# volta a verificar

S_GS1_FIM:
        ret